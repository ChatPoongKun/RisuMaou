function (triggerId)
    debug("turnEnd 실행")
    
    --HP/SP 회복 처리 함수
    --isNight: true면 밤(높은 회복률), false면 낮(낮은 회복률)
    local function processRecovery(triggerId, charName, isNight)
        local char = json.decode(getLoreBookContent(triggerId, charName))
        
        --기본 회복률 설정
        local hpGen, spGen
        if isNight then
            hpGen = 0.1
            spGen = 0.15
        else
            hpGen = 0.05
            spGen = 0.1
        end
        
        --빠른회복 미보유 또는 실신 시 회복률 감소
        if char["빠른회복"] == 0 or char["condition"] == "실신" then
            hpGen = hpGen - 0.05
            if not isNight then
                hpGen = 0  --낮에는 회복 없음
            end
        end
        
        --실신 시 HP 회복 50% 감소
        if char["condition"] == "실신" then
            hpGen = hpGen * 0.5
        end
        
        --실제 회복 계산
        local maxHP = tonumber(char["최대체력"])
        local maxSP = tonumber(char["최대기력"])
        local currentHP = tonumber(char["체력"])
        local currentSP = tonumber(char["기력"])
        
        char["체력"] = intForm(math.min(currentHP + math.floor(maxHP * hpGen), maxHP))
        char["기력"] = intForm(math.min(currentSP + math.floor(maxSP * spGen), maxSP))
        
        --기력이 90% 이상 회복되면 실신에서 조교가능으로 변경
        if tonumber(char["기력"]) > maxSP * 0.9 and char["condition"] == "실신" then
            char["condition"] = "조교가능"
        end
        
        --로어북에 저장
        upsertLocalLoreBook(triggerId, charName, json.encode(char), DEFAULT_LORE_OPTION)
        
        return char
    end
    
    --시간 정보 호출
    local day = getChatVar(triggerId, "day")
    local ampm = getChatVar(triggerId, "ampm")
    local chars = json.decode(getChatVar(triggerId, "chars"))
    local isNight = (ampm == "1")
    
    --알림 메시지
    if isNight then
        alertNormal(triggerId, "하루가 지나갑니다...")
    else
        alertNormal(triggerId, "밤이 깊어옵니다...")
    end

    --모든 캐릭터에 대해 회복 처리 (유틸리티 함수 사용)
    for _, charName in ipairs(chars) do
        processRecovery(triggerId, charName, isNight)
    end

    --시간흐름 처리
    day = day + ampm
    ampm = math.abs(ampm - 1)
    debug(day.."일 "..ampm)
    setChatVar(triggerId, "day", day)
    setChatVar(triggerId, "ampm", ampm)

    --갱신된 유저정보 변수저장
    local user = json.decode(getLoreBookContent(triggerId, "user"))
    stateToVar(triggerId, "user", user)
end
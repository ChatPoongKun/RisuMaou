function (triggerId)
    --초기 변수 설정
    print("initVars 실행")
    local option = {alwaysActive = false, insertOrder = 100, key = "", secondKey = "", regex = false} --로어북 저장용 옵션
    local initVars = {
        spirit = "10,000",
        day = "1",
        ampm = "0", --0은 낮 1은 밤
        dungeonLv = "1", --던전레벨 1로 시작
        chars = '["user","마오"]', --리수배열 스타일에 맞게 저장
        trainDifficulty = "보통", --조교난이도 보통
        blockDeath = 1, --사망방지 O
        ageLimit = "12", --등장 용사 나이제한 12세
        ntrLimit = "1", --등장 용사 나이제한 12세
        futaLimit = "0", --후타용사 등장 X
        maleLimit = "0", --남성용사 등장 X
        raceLimit = "1", --인외종족 등장 0:모두, 1:인간만
        trainTargetPanel = "1", --조교화면 대상정보 상단고정 O
        trainUserPanel = "0", --조교화면 유저정보 상단고정 X
        combatDifficulty = "보통", --전투난이도 보통
        heroLvLimit = "5", --용사의 레벨 제한
        showLog = "0", --과거 조교기록 보기. 기본값 OFF
        debug = DEBUG, --콘솔 디버그 표시
        king = '{"성별":"남성","페니스":"대물","음모":"무성함", "외형":"중년","헤어스타일":"날렵하게 세워올린 짧은 은발"}', --광왕 디폴트 설정
        models = '{"trainResponse":"0","trainLog":"1", "newChar":"0"}', --상황별 사용 모델 설정. 0:보조모델, 1:메인모델
    }

    for key, value in pairs(initVars) do
        setChatVar(triggerId, key, value)
    end

    --인벤토리 초기화
    local inventory = {}
    local items = getDB(triggerId, "items.db") 
    local items = getDB(triggerId, "items.db") 
    for cat, list in pairs(items) do
        for k, v in pairs(list) do
            inventory[k] = 0
        end
    end
    -- trap.db의 함정들도 인벤토리에 추가
    local traps = getDB(triggerId, "trap.db")
    for k, v in pairs(traps) do
        inventory[k] = 0
    end
    stateToVar(triggerId, "inventory", inventory)


    --수정구 기록 초기화
    upsertLocalLoreBook(triggerId, "crystalRec", "{}", option)

    --user 및 고유캐릭터 정보를 로컬 로어북에 저장
    local trace = {}
    for _, v in ipairs(json.decode(initVars.chars)) do --리수배열 스타일에 맞게 저장
        local content = json.decode(getLoreBookContent(triggerId, v..".init")) -- 대상 캐릭터의 로어북을 불러와 테이블로 저장
        
        --캐릭터에는 정의가 필요한 부분만 들어있음. 캐릭터 시트에 없는 trait, trace등의 필드를 db에서 읽어와서 추가
        --새 구조에서는 mark.db, abl.db, exp.db의 키 값을 전부 0으로 초기화해서 추가
        local dbNames = {"mark.db", "abl.db", "exp.db"}
        local added = ""
        
        for _, dbName in ipairs(dbNames) do
            local dbData = getDB(triggerId, dbName)
            for key, val in pairs(dbData) do
                -- DB의 한글 이름(name 필드)을 키로 사용
                if val.name then
                   local korKey = val.name
                   if not content[korKey] then
                       content[korKey] = "0"
                       added = added .. ", ".. korKey
                   end
                else
                    -- name 필드가 없으면 키 자체를 사용 (비상시)
                    if not content[key] then
                       content[key] = "0"
                       added = added .. ", ".. key
                   end
                end
            end
        end
        debug(v.."의 캐릭터 테이블에 ".. added.."필드 추가")

        --캐릭터 정보를 로컬로어북에 저장
        upsertLocalLoreBook(triggerId, v, json.encode(content), option)

        --캐릭터의 흔적은 별도의 state로 저장 (trace.db 사용)
        local traceDB = getDB(triggerId, "trace.db")
        trace[v] = {}
        for _, val in pairs(traceDB) do
            if val.name then
                trace[v][val.name] = 0
            end 
        end
    end
    setState(triggerId, "trace", trace)

    --유저 정보를 user변수에 테이블로 할당
    local user = json.decode(getLoreBookContent(triggerId, "user"))
    stateToVar(triggerId, "user", user)


    --###########################
    --DB 로딩 및 리스트 생성 (JSON 기반 + 정렬)
    --###########################
    
    -- DB 로딩 및 리스트 생성 (JSON 기반 + 정렬)
    -- useName: true이면 한글 이름(v.name)을 리스트에 저장, false/nil이면 영문 키(k)를 저장
    local function createListFromDB(dbName, useName)
        local db = getDB(triggerId, dbName)
        local list = {}
        for k, v in pairs(db) do
            if useName and v.name then
                table.insert(list, v.name)
            else
                table.insert(list, k)
            end
        end
        table.sort(list)
        return list
    end

    -- 1. 단순 구조 DB - 키(Key)를 사용하는 리스트
    -- race, class, monster는 RNG나 시스템 내부에서 키로 접근함
    local keyListDBs = {
        ["race"] = "race.db",
        ["class"] = "class.db",
        ["monsters"] = "monsters.db"
    }

    for name, filename in pairs(keyListDBs) do
        local list = createListFromDB(filename, false)
        setChatVar(triggerId, name.."List", json.encode(list))
    end

    -- 2. 단순 구조 DB - 이름(Name)을 사용하는 리스트
    -- abl, exp, mark, stat은 캐릭터 데이터에 한글 이름으로 저장되고 HTML에서 순회함
    local nameListDBs = {
        ["abl"] = "abl.db",
        ["exp"] = "exp.db",
        ["mark"] = "mark.db",
        ["stat"] = "stat.db"
    }

    for name, filename in pairs(nameListDBs) do
        local list = createListFromDB(filename, true)
        setChatVar(triggerId, name.."List", json.encode(list))
    end
    
    -- traceList (trace.db 기반 한글 이름 리스트)
    local traceDB = getDB(triggerId, "trace.db")
    local traceList = {}
    for k, v in pairs(traceDB) do
        if v.name then table.insert(traceList, v.name) end
    end
    table.sort(traceList)
    setChatVar(triggerId, "traceList", json.encode(traceList))


    -- 2. Items & Traps (카테고리 분류) - 아이템은 영문 키 유지 (상점에서 키 사용)
    local itemsDB = getDB(triggerId, "items.db")
    local trapDB = getDB(triggerId, "trap.db")
    
    local toolsList = {}
    local consumablesList = {}
    local unlockList = {}
    local trapsList = {}
    local itemNameMap = {}

    -- items.db는 [카테고리][키] 구조임
    for category, items in pairs(itemsDB) do
        if category == "tools" then
            for k, v in pairs(items) do 
                table.insert(toolsList, k)
                if v.name then itemNameMap[k] = v.name end
            end
        elseif category == "consumables" then
            for k, v in pairs(items) do 
                table.insert(consumablesList, k)
                if v.name then itemNameMap[k] = v.name end
            end
        elseif category == "unlock" then
            for k, v in pairs(items) do 
                table.insert(unlockList, k)
                if v.name then itemNameMap[k] = v.name end
            end
        end
    end
    
    for k, v in pairs(trapDB) do
        table.insert(trapsList, k)
        if v.name then itemNameMap[k] = v.name end
    end
    
    table.sort(toolsList); table.sort(consumablesList); table.sort(unlockList); table.sort(trapsList)
    
    setChatVar(triggerId, "toolsList", json.encode(toolsList))
    setChatVar(triggerId, "consumablesList", json.encode(consumablesList))
    setChatVar(triggerId, "unlockList", json.encode(unlockList))
    setChatVar(triggerId, "trapsList", json.encode(trapsList))
    setChatVar(triggerId, "itemNameMap", json.encode(itemNameMap))


    -- 3. Trait (평탄화된 구조에서 카테고리 분류) - 특성은 한글 이름 사용 (캐릭터 데이터 키)
    local traitDB = getDB(triggerId, "trait.db")
    local traitLists = {
        ["성격"] = {},
        ["신체특성"] = {},
        ["성적취향"] = {},
        ["체질"] = {},
        ["칭호"] = {}
    }

    for k, v in pairs(traitDB) do
        if v.category and traitLists[v.category] then
            table.insert(traitLists[v.category], v.name) -- 한글 이름 저장
        end
    end

    for k, list in pairs(traitLists) do
        table.sort(list)
        setChatVar(triggerId, k.."List", json.encode(list))
    end

    addChat(triggerId, "user", "{{".."getvar::html".."}}")
end

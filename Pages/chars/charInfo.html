
<style>
    /* Character Profile Section */
    .character-profile {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        align-items: flex-start;
    }

    .profile-main {
        display: flex;
        gap: 1.5rem;
        align-items: center;
        /*flex-basis: 320px;*/
        flex-grow: 1;
    }

    .character-portrait {
        width: 128px;
        height: 128px;
        background-color: #111;
        border: 1px solid #444;
        flex-shrink: 0;
        border-radius: 8px;
        overflow: hidden;
    }

    .profile-details h2 {
        margin: 0 0 0.5rem 0;
        font-size: 1.5em;
        color: #ffffff;
    }

    .profile-details p {
        margin: 0.25rem 0;
        color: #ccc;
        font-size: 0.95em;
    }

    .profile-stats {
        flex-basis: 320px;
        flex-grow: 2;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        padding-top: 0.5rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 0.5rem 1rem;
        margin-top: 1rem;
        background-color: #3a3a3a;
        padding: 1rem;
        border-radius: 4px;
    }

    /* Tabs for Detailed Info */
    .tabs-container {
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
    }

    .tabs-container::-webkit-scrollbar{
        display: none;
    }

    .tabs {
        display: flex;
        gap: 0.5rem;
        border-bottom: 1px solid #555;
        padding-bottom: 0.5rem;
    }

    .tabs label {
        padding: 0.5rem 1rem;
        background-color: #444;
        border: 1px solid #666;
        color: #e0e0e0;
        cursor: pointer;
        border-radius: 4px 4px 0 0;
        transition: all 0.2s ease;
        position: relative;
        bottom: -1px;
    }

    .tab-content {
        margin-top: 0;
        padding: 1.3rem;
        background-color: #383838;
        border: 1px solid #555;
        border-top: none;
        border-radius: 0 0 4px 4px;
        min-height: 200px;
    }

    .tab-content > .tab-pane {
        display: none;
    }

    input[name="detail-tabs"]:checked + label {
        background-color: #383838;
        border-color: #555;
        border-bottom-color: #383838;
        color: #fff;
    }
/*
    #talents-tab:checked ~ .tab-content > #talents-content,
    #abl-tab:checked ~ .tab-content > #abl-content,
    #exp-tab:checked ~ .tab-content > #exp-content,
    #appearance-tab:checked ~ .tab-content > #appearance-content,
    #narrative-tab:checked ~ .tab-content > #narrative-content {
        display: block;
    }
*/
    #talents-tab:checked ~ .tab-content > #talents-content,
    #abl-tab:checked ~ .tab-content > #abl-content,
    #exp-tab:checked ~ .tab-content > #exp-content,
    #appearance-tab:checked ~ .tab-content > #appearance-content,
    #narrative-tab:checked ~ .tab-content > #narrative-content {
        display: block;
    }


    /* Info Grids within Tabs */
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 1rem 0.75rem;
    }
    
    .info-grid h3 {
        font-size: 1.1em;
        color: #ffffff;
        grid-column: 1 / -1;
        margin-top: 0.5rem;
        margin-bottom: 0rem;
        border-bottom: 1px solid #4f4f4f;
        /*padding-bottom: 0.5rem;*/
    }
    .info-grid h3:first-child {
        margin-top: 0;
    }
    
    .info-grid .talent-tag {
        background-color: #2a2a2a;
        padding: 0.1rem 0.3rem;
        border-radius: 2px;
        font-family: monospace;
        font-size: 0.9em;
        margin: 0 0.2rem;
        border: 1px solid #4f4f4f; 
    }

    .mark-item {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    .mark-item .bar-label {
        flex-basis: 4.5rem;
        text-align: right;
        flex-shrink: 0;
    }

    /* Imprints Section - Grid layout */
    .marks-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 0.75rem;
    }
    .marks-grid .mark-item {
        justify-content: space-between;
        background-color: #3a3a3a;
        padding: 0.5rem 1rem;
        border-radius: 4px;
    }
    .marks-grid .mark-item .bar-label {
        flex-basis: auto;
        text-align: left;
    }


    /* Talents Tab - Flexbox layout for tags */
    #talents-content .info-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.1rem 0.2rem;
    }
    #talents-content .info-grid h3 {
        width: 100%;
        margin-bottom: 0.5rem;
    }

    /* Abilities Tab - Grid layout */
    #abl-content .info-grid {
        grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
        align-items: center;
    }
    .abl-item {
        display: flex;
        /* justify-content: space-between; -- REMOVED */
        align-items: center;
        gap: 1rem;
        padding: 0.2rem 0.5rem; 
        border: 1px solid #4f4f4f; 
        border-radius: 4px; 
        background-color: #2a2a2a;
        justify-content: space-between;
    }

    /* Experience Tab - Grid layout */
    #exp-content .info-grid {
        grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
    }
    
    .exp-list p, .appearance-content p {
        margin: 0 0 0.75rem 0;
        line-height: 1.6;
    }
    .exp-list p:last-child, .appearance-content p:last-child {
            margin-bottom: 0;
    }

    /* Equipment Section */
    .equipment-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 0.75rem;
    }
    .equipment-item {
        background-color: #3a3a3a;
        padding: 0.75rem;
        border-radius: 4px;
    }
    .equipment-item .item-type {
        font-weight: bold;
        color: #ffffbf;
        margin-right: 0.5em;
    }
    
    /* Jewel Section */
    .jewel-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 0.75rem;
        background-color: #3a3a3a;
        padding: 1rem;
        border-radius: 4px;
    }

    /* Narrative Tab */
    .narrative-block {
        margin-bottom: 1.5rem;
    }
    .narrative-block h3 {
        font-size: 1.1em;
        color: #ffffff;
        margin-bottom: 0.75rem;
        border-bottom: 1px solid #4f4f4f;
        padding-bottom: 0.5rem;
    }
    .narrative-block p, .narrative-block ul {
        background-color: #2a2a2a;
        padding: 0.75rem;
        border-radius: 4px;
        line-height: 1.6;
        margin: 0;
    }
     .narrative-block ul {
        padding-left: 2.5rem;
     }

    @media screen and (max-width: 600px){
        .info-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)) !important;
        gap: 0.75rem 0.5rem;
        }

        .marks-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)) !important;
        gap: 0.75rem 0.5rem;
        }
        
        .tab-content{
            padding: 1rem;
        }
        
        .equipment-item {
        padding: 0.3rem;
        }
        
        .abl-item {
        font-size: 0.65rem;
        gap:0.3rem;
        }
        .info-grid .talent-tag {
        font-size: 0.9em;
        margin: 0 0.2rem;
        border: 1px solid #4f4f4f; 
        }
}
</style>

<div class="container">
<header class="header">
<h1>▋ 캐릭터 상세 정보</h1>
</header>
<div class="line double"></div>

<main>
<section class="character-profile">
<div class="profile-main">
<div class="character-portrait"><img src="{{#when::{{dict_element::{{getvar::target}}::이름}}::is::{{user}}}}{{source::user}}{{:else}}{{raw::{{dict_element::{{getvar::target}}::이름}}.png}}{{/when}}" style="margin:0px;border-radius:1em"></div>
<div class="profile-details">
<h2>{{dict_element::{{getvar::target}}::이름}} Lv.{{dict_element::{{getvar::target}}::레벨}}</h2>
<p><strong>종족:</strong> {{dict_element::{{getvar::target}}::종족}}</p>
<p><strong>성별:</strong> {{dict_element::{{getvar::target}}::성별}}</p>
<p><strong>직업:</strong> {{dict_element::{{getvar::target}}::클래스}}</p>
<p><strong>나이:</strong> {{dict_element::{{getvar::target}}::나이}}</p>
</div>
</div>
<div class="profile-stats">
<div class="x-risu-bar-container">
<span class="bar-label">체력:</span>
<div class="progress-bar">
<div class="x-risu-progress-bar-fill x-risu-hp" style="width: {{calc::{{tonumber::{{dict_element::{{getvar::target}}::체력}}}} / {{tonumber::{{dict_element::{{getvar::target}}::최대체력}}}} * 100}}%;"></div>
</div>
<span class="bar-value">{{dict_element::{{getvar::target}}::체력}}/{{dict_element::{{getvar::target}}::최대체력}}</span>
</div>
<div class="x-risu-bar-container">
<span class="bar-label">기력:</span>
<div class="progress-bar">
<div class="x-risu-progress-bar-fill x-risu-st" style="width: {{calc::{{tonumber::{{dict_element::{{getvar::target}}::기력}}}} / {{tonumber::{{dict_element::{{getvar::target}}::최대기력}}}} * 100}}%;"></div>
</div>
<span class="bar-value">{{dict_element::{{getvar::target}}::기력}}/{{dict_element::{{getvar::target}}::최대기력}}</span>
</div>
<div class="stats-grid">
<span><strong>공격:</strong> {{dict_element::{{getvar::target}}::공격력}}</span>
<span><strong>방어:</strong> {{dict_element::{{getvar::target}}::방어력}}</span>
<span><strong>카르마:</strong> {{dict_element::{{getvar::target}}::카르마}}</span>
<span><strong>소지금:</strong> {{dict_element::{{getvar::target}}::소지금}}</span>
<span><strong>빚:</strong> {{dict_element::{{getvar::target}}::빚}}</span>
</div>
</div>
</section>

<div class="line single"></div>

<section class="detailed-info">
<input type="radio" name="detail-tabs" id="abl-tab" hidden>
<input type="radio" name="detail-tabs" id="exp-tab" hidden>
<input type="radio" name="detail-tabs" id="talents-tab" checked hidden>
<input type="radio" name="detail-tabs" id="appearance-tab" hidden>
<input type="radio" name="detail-tabs" id="narrative-tab" hidden>
<div class="tabs-container">
<label for="talents-tab" class="x-risu-btn">▋특성</label>
<label for="abl-tab" class="x-risu-btn">▋능력</label>
<label for="exp-tab" class="x-risu-btn">▋경험</label>
<label for="appearance-tab" class="x-risu-btn">▋외모</label>
<label for="narrative-tab" class="x-risu-btn">▋서사</label>
</div>
<div class="tab-content">
<div id="talents-content" class="tab-pane">
<div class="info-grid">
<h3>성격</h3>
{{#each {{getvar::성격List}} T}}{{#when::{{? {{dict_element::{{getvar::target}}::{{slot::T}}}} == 1}}}}<span class="talent-tag">[{{slot::T}}]</span>{{/when}}{{/each}}
<h3>신체특성</h3>
{{#each {{getvar::신체특성List}} T}}{{#when::{{? {{dict_element::{{getvar::target}}::{{slot::T}}}} == 1}}}}<span class="talent-tag">[{{slot::T}}]</span>{{/when}}{{/each}}
<h3>성적취향</h3>
{{#each {{getvar::성적취향List}} T}}{{#when::{{? {{dict_element::{{getvar::target}}::{{slot::T}}}} == 1}}}}<span class="talent-tag">[{{slot::T}}]</span>{{/when}}{{/each}}
<h3>체질</h3>
{{#each {{getvar::체질List}} T}}{{#when::{{? {{dict_element::{{getvar::target}}::{{slot::T}}}} == 1}}}}<span class="talent-tag">[{{slot::T}}]</span>{{/when}}{{/each}}
</div>
</div>

<div id="abl-content" class="tab-pane">
<div class="info-grid">
{{#each {{getvar::ablList}} abil}}
{{#when::{{dict_element::{{getvar::target}}::{{slot::abil}}}}::isnot::0}}
<div class="abl-item"><span>{{slot::abil}}</span>
<div class="rating heart {{#when::{{dict_element::{{getvar::target}}::{{slot::abil}}}}::is::10}}is-full{{/when}}" style="--rating: {{dict_element::{{getvar::target}}::{{slot::abil}}}}">
</div></div>
{{/when}}
{{/each}}
</div>
</div>

<div id="exp-content" class="tab-pane">
<div class="info-grid">
{{#each {{getvar::expList}} exp}}
{{#when::{{dict_element::{{getvar::target}}::{{slot::exp}}}}::isnot::0}}
<div class="talent-tag"><strong>{{slot::exp}}:</strong> {{dict_element::{{getvar::target}}::{{slot::exp}}}}</div>
{{/when}}
{{/each}}
</div>
<div class="line single" style="margin-top:1.5rem"></div>
<p class="total-info" style="margin-top: 1.5rem !important;">
<strong>다음 레벨까지:</strong> {{? {{array_element::{{getvar::Lvtable}}::{{dict_element::{{getvar::target}}::레벨}}}}-{{dict_element::{{getvar::target}}::경험치}}}} EXP<br>
<strong>총 획득 경험치:</strong> {{dict_element::{{getvar::target}}::경험치}} EXP
</p>
</div>

<div id="appearance-content" class="tab-pane">
<div class="appearance-content">
<p><strong>키:</strong> {{dict_element::{{getvar::target}}::키}}cm | <strong>몸무게:</strong> {{dict_element::{{getvar::target}}::몸무게}}kg</p>
<p><strong>헤어스타일:</strong> {{dict_element::{{getvar::target}}::머리}}</p>
<p><strong>복장:</strong> {{dict_element::{{getvar::target}}::복장}}</p>
<p><strong>가슴:</strong> {{dict_element::{{getvar::target}}::가슴}} | <strong>유두:</strong> {{dict_element::{{getvar::target}}::유두}}</p>
<p><strong>음모:</strong> {{dict_element::{{getvar::target}}::음모}}</p>
{{#when::{{dict_element::{{getvar::target}}::페니스}}::isnot::}}<p><strong>페니스:</strong> {{dict_element::{{getvar::target}}::페니스}}</p>{{/when}}
{{#when::{{dict_element::{{getvar::target}}::자궁정액}}::isnot::0}}<p>자궁에 <strong>{{dict_element::{{getvar::target}}::자궁정액}}ml</strong>의 정액이 들어있습니다.</p>{{/when}}
{{#when::{{dict_element::{{getvar::target}}::애널정액}}::isnot::0}}<p>애널에 <strong>{{dict_element::{{getvar::target}}::애널정액}}ml</strong>의 정액이 들어있습니다.</p>{{/when}}
{{#when::{{dict_element::{{getvar::target}}::문신}}::isnot::}}<p><strong>문신:</strong> {{dict_element::{{getvar::target}}::문신}}</p>{{/when}}
{{#when::{{dict_element::{{getvar::target}}::피어싱}}::isnot::}}<p><strong>피어싱:</strong> {{dict_element::{{getvar::target}}::피어싱}}</p>{{/when}}
</div>
</div>

<div id="narrative-content" class="tab-pane">
<div class="narrative-block">
<h3>첫경험</h3>
<p><strong>첫키스 상대:</strong> {{dict_element::{{getvar::target}}::첫키스 상대}}<br>
<strong>첫경험 상대:</strong> {{dict_element::{{getvar::target}}::첫경험 상대}}</p>
</div>
{{#when::{{dict_element::{{getvar::target}}::가족관계}}::isnot::null}}
<div class="narrative-block"><h3>가족관계</h3><p>{{dict_element::{{getvar::target}}::가족관계}}</p></div>{{/when}}
{{#when::{{dict_element::{{getvar::target}}::용사가 된 동기}}::isnot::null}}
<div class="narrative-block"><h3>용사가 된 동기</h3><p>{{dict_element::{{getvar::target}}::용사가 된 동기}}</p></div>{{/when}}
{{#when::{{dict_element::{{getvar::target}}::용사가 되기 전}}::isnot::null}}
<div class="narrative-block"><h3>용사가 되기 전</h3><p>{{dict_element::{{getvar::target}}::용사가 되기 전}}</p></div>{{/when}}
<!--{{#when::{{? {{array_length::{{dict_element::{{getvar::target}}::이상경험 기록}}}} > 0}}}}
<div class="narrative-block"><h3>이상경험 기록</h3><ul>
{{#each {{dict_element::{{getvar::target}}::이상경험 기록}} R}}<li>{{slot::R}}</li>{{/each}}
</ul></div>{{/when}}    이상경험 출력부 개선안 필요-->
</div>
</div>
</section>

<div class="line single"></div>

<section class="marks-section">
<h2>* 각인</h2>
<div class="marks-grid">
<div class="mark-item"><span class="bar-label">고통:</span> <div class="rating mark {{#when::{{dict_element::{{getvar::target}}::고통각인}}::is::3}}is-full{{/when}}" style="--rating: {{dict_element::{{getvar::target}}::고통각인}}"></div></div>
<div class="mark-item"><span class="bar-label">쾌락:</span> <div class="rating mark {{#when::{{dict_element::{{getvar::target}}::쾌락각인}}::is::3}}is-full{{/when}}" style="--rating: {{dict_element::{{getvar::target}}::쾌락각인}}"></div></div>
<div class="mark-item"><span class="bar-label">쾌락:</span> <div class="rating mark {{#when::{{dict_element::{{getvar::target}}::공포각인}}::is::3}}is-full{{/when}}" style="--rating: {{dict_element::{{getvar::target}}::공포각인}}"></div></div>
<div class="mark-item"><span class="bar-label">복종:</span> <div class="rating mark {{#when::{{dict_element::{{getvar::target}}::복종각인}}::is::3}}is-full{{/when}}" style="--rating: {{dict_element::{{getvar::target}}::복종각인}}"></div></div>
<div class="mark-item"><span class="bar-label">치욕:</span> <div class="rating mark {{#when::{{dict_element::{{getvar::target}}::치욕각인}}::is::3}}is-full{{/when}}" style="--rating: {{dict_element::{{getvar::target}}::치욕각인}}"></div></div>
<div class="mark-item"><span class="bar-label">반발:</span> <div class="rating mark neg {{#when::{{dict_element::{{getvar::target}}::반발각인}}::is::3}}is-full{{/when}}" style="--rating: {{dict_element::{{getvar::target}}::반발각인}}"></div></div>
</div>
</section>

<div class="line single"></div>

<section class="jewel-section">
<h2>* 주얼</h2>
<div class="jewel-grid">
{{#each {{getvar::juelList}} juel}}
{{#when::{{dict_element::{{getvar::targetJuel}}::{{slot::juel}}}}::isnot::0}}
<div class="talent-tag"><strong>{{slot::juel}}:</strong> {{dict_element::{{getvar::targetJuel}}::{{slot::juel}}}}</div>
{{/when}}
{{/each}}
</div>
</section>

<div class="line single"></div>

<section class="equipment-section">
<h2>* 장비</h2>
<div class="equipment-grid">
<div class="equipment-item">
<span class="item-type">【무기】</span><span>{{dict_element::{{getvar::target}}::무기}}</span>
</div>
<div class="equipment-item">
<span class="item-type">【반지A】</span><span>{{dict_element::{{getvar::target}}::반지1}}</span>
</div>
<div class="equipment-item">
<span class="item-type">【반지B】</span><span>{{dict_element::{{getvar::target}}::반지2}}</span>
</div>
</div>
</section>

<div class="line single"></div>

<section class="command-panel">
<h3>▋Commands</h3>
<div class="command-container">
{{getvar::cmds}}
</div>
</section>
</main>

<div class="line double"></div>
</div>
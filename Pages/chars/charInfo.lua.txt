[charInfo/appearance/hidden] function(triggerId)
    local charInfoCat = "appearance"
    setChatVar(triggerId, "category", charInfoCat)
end!!

[charInfo/abl/hidden] function(triggerId)
    local charInfoCat = "abl"
    setChatVar(triggerId, "category", charInfoCat)
end!!

[charInfo/talents/hidden] function(triggerId)
    local charInfoCat = "talents"
    setChatVar(triggerId, "category", charInfoCat)
end!!

[charInfo/exp/hidden] function(triggerId)
    local charInfoCat = "exp"
    setChatVar(triggerId, "category", charInfoCat)
end!!

[charInfo/narrative/hidden] function(triggerId)
    local charInfoCat = "narrative"
    setChatVar(triggerId, "category", charInfoCat)
end!!

[charInfo/101/능력 레벨업] function(triggerId)
    screenChange(triggerId, "ablUp")
end!!

[charInfo/102/장비 관리] function(triggerId)
    alertNormal(triggerId, "미구현")
end!!

[charInfo/103/소모품 사용] function(triggerId)
    -- 이미 열려있으면 닫기
    if getChatVar(triggerId, "charSubCat") == "item" then
        setChatVar(triggerId, "charSubCat", "")
        return
    else
        setChatVar(triggerId, "charSubCat", "item")
    end
end!!

[charInfo/104/수정구 기록] function(triggerId)
    alertNormal(triggerId, "미구현")
end!!

[charInfo/use_영양제/hidden] function(triggerId)
    local itemName = "영양제"
    local inventory = json.decode(getChatVar(triggerId, "inventory"))
    local target = json.decode(getChatVar(triggerId, "target"))
    local target = json.decode(getLoreBookContent(triggerId, target["이름"]))
    local max = tonumber(target["최대체력"])
    local recover = math.floor(max * 0.25) --최대 체력의 25% 회복

    if tonumber(inventory[itemName] or 0) <= 0 then
        alertNormal(triggerId, itemName.."이 부족합니다.")
        return
    elseif tonumber(target["체력"]) >= max then
        alertNormal(triggerId, target["이름"].."의 체력이 이미 최대치입니다.")
        return
    end

    -- 회복 효과 적용
    target["체력"] = intForm(math.min(max, tonumber(target["체력"]) + recover))

    -- 인벤토리 차감 및 저장
    inventory[itemName] = tostring(tonumber(inventory[itemName]) - 1)
    setChatVar(triggerId, "inventory", json.encode(inventory))

    -- 타겟 정보 저장
    local option = {alwaysActive = false, insertOrder = 100, key = "", secondKey = "", regex = false}
    upsertLocalLoreBook(triggerId, target["이름"], json.encode(target), option)
    setState(triggerId, "target", target)
    stateToVar(triggerId, "target", target)

    alertNormal(triggerId, target["이름"].."에게 "..itemName.."를 사용했습니다. ("..target["체력"].."/"..max..")")
end!!

[charInfo/use_향/hidden] function(triggerId)
    local itemName = "향"
    local inventory = json.decode(getChatVar(triggerId, "inventory"))
    local target = json.decode(getChatVar(triggerId, "target"))
    local target = json.decode(getLoreBookContent(triggerId, target["이름"]))
    local max = tonumber(target["최대기력"])
    local recover = math.floor(max * 0.25) --최대 기력의 25% 회복

    if tonumber(inventory[itemName] or 0) <= 0 then
        alertNormal(triggerId, itemName.."이 부족합니다.")
        return
    elseif tonumber(target["기력"]) >= max then
        alertNormal(triggerId, target["이름"].."의 기력이 이미 최대치입니다.")
        return
    end

    -- 회복 효과 적용
    target["기력"] = intForm(math.min(max, tonumber(target["기력"]) + recover))

    -- 인벤토리 차감 및 저장
    inventory[itemName] = tostring(tonumber(inventory[itemName]) - 1)
    setChatVar(triggerId, "inventory", json.encode(inventory))

    -- 타겟 정보 저장
    local option = {alwaysActive = false, insertOrder = 100, key = "", secondKey = "", regex = false}
    upsertLocalLoreBook(triggerId, target["이름"], json.encode(target), option)
    setState(triggerId, "target", target)
    stateToVar(triggerId, "target", target)

    alertNormal(triggerId, target["이름"].."에게 "..itemName.."를 사용했습니다. ("..target["기력"].."/"..max..")")
end!!

[charInfo/use_구충제/hidden] function(triggerId)
end!!

[charInfo/use_강모제/hidden] function(triggerId)
    local itemName = "강모제"
    local inventory = json.decode(getChatVar(triggerId, "inventory"))
    local target = json.decode(getChatVar(triggerId, "target"))
    local target = json.decode(getLoreBookContent(triggerId, target["이름"]))
    local max = "무성함"

    if tonumber(inventory[itemName] or 0) <= 0 then
        alertNormal(triggerId, itemName.."이 부족합니다.")
        return
    elseif hasVal(target, "무모증") then
        alertNormal(triggerId, target["이름"].."의 음모는 무모증으로 자라날 수 없습니다.")
        return
    end

    -- 효과 적용
    if target["음모"] == "없음" then
        target["음모"] = "짧음"
    elseif target["음모"] == "짧음" then
        target["음모"] = "보통"
    elseif target["음모"] == "보통" then
        target["음모"] = "무성함"
    end

    -- 인벤토리 차감 및 저장
    inventory[itemName] = tostring(tonumber(inventory[itemName]) - 1)
    setChatVar(triggerId, "inventory", json.encode(inventory))

    -- 타겟 정보 저장
    local option = {alwaysActive = false, insertOrder = 100, key = "", secondKey = "", regex = false}
    upsertLocalLoreBook(triggerId, target["이름"], json.encode(target), option)
    setState(triggerId, "target", target)
    stateToVar(triggerId, "target", target)

    alertNormal(triggerId, target["이름"].."의 음모가 자라났습니다.("..target["음모"]..")")
end!!

[charInfo/199/hidden] function(triggerId)
    setState(triggerId, "target", "") --조회대상 초기화
    setChatVar(triggerId, "target", "") --조회대상 초기화
    screenChange(triggerId, "charList")
    setChatVar(triggerId, "category", "index")
    setChatVar(triggerId, "charSubCat", "")
end!!
<style>
/* Character Dashboard */
.character-panel {
margin-bottom: 1.5rem;
}

.character-display {
display: flex;
gap: 1rem;
background: #181818;
padding: 1rem;
border: 1px solid #282828;
border-left: 3px solid #60d9f7;
align-items: flex-start;
}

.character-portrait {
width: 80px;
height: 80px;
background: #000;
border: 1px solid #333;
flex-shrink: 0;
overflow: hidden;
}

.character-info-wrapper {
flex-grow: 1;
min-width: 0;
}

/* min-width 0 prevents flex child overflow */

.panel-header {
display: flex;
justify-content: space-between;
align-items: baseline;
margin-bottom: 0.5rem;
flex-wrap: wrap;
}

.panel-header h2 {
font-size: 1.1rem;
border: none;
padding: 0;
margin: 0;
color: #fff;
}

.panel-sub {
font-size: 0.8rem;
color: #666;
}

/* Status Bars in Main */
.player-status {
display: flex;
flex-direction: column;
gap: 0.25rem;
}

/* Management Panel */
.management-panel {
margin-bottom: 1.5rem;
}

.info-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
gap: 0.25rem;
}

.inventory-item {
background: #222;
padding: 0.2rem 0.3rem;
border-radius: 2px;
font-size: 0.75rem;
color: #ccc;
border: 1px solid #333;
display: flex;
align-items: center;
overflow: hidden;
white-space: nowrap;
}

.inventory-item span {
overflow: hidden;
text-overflow: ellipsis;
}

.dungeon-floor-grid {
display: flex;
flex-direction: column;
gap: 0.5rem;
}

.dungeon-floor {
background: #1a1a1a;
padding: 0.75rem;
border-left: 2px solid #444;
font-size: 0.9rem;
}

.dungeon-floor strong {
color: #60d9f7;
margin-right: 0.5rem;
}

.section-label {
font-weight: 600;
color: #ddd;
text-transform: uppercase;
margin-bottom: 0.5rem;
display: block;
border-bottom: 1px solid #222;
}

/* Mobile Optimization */
@media screen and (max-width: 400px) {
.character-display {
padding: 0.75rem;
gap: 0.75rem;
}

.character-portrait {
width: 60px;
height: 60px;
}

.panel-header h2 {
font-size: 1rem;
width: 100%;
}
}
</style>

<div class="container">
<header class="header">
<h1>ë©”ì¸ ë©”ë‰´</h1>
<div class="game-info">
<span>Day {{getvar::day}} {{#when::{{? {{? {{floor{{getvar::day}}%29.5}}}} == 15}}}}<span
style="color:#fbc02d">ã€Šë§Œì›”ã€‹</span>{{/when}} {{#when::ampm::vis::0}}â˜€ï¸ ë‚®{{:else}}ğŸŒ™ ë°¤{{/when}}</span>
<span>{{getvar::spirit}} Spirit</span>
</div>
</header>

<main>
<!-- Character Dashboard -->
<section class="character-panel">
<div class="character-display">
<div class="character-portrait"><img src="{{source::user}}"></div>
<div class="character-info-wrapper">
<div class="panel-header">
<h2>{{user}}</h2>
<span class="panel-sub">Lv. {{dict_element::{{getvar::user}}::ë ˆë²¨}} ë§ˆì™•</span>
</div>
<div class="player-status">
<div class="x-risu-bar-container">
    <div class="progress-bar">
        <div class="x-risu-progress-bar-fill x-risu-hp"
            style="width: {{calc::{{tonumber::{{dict_element::{{getvar::user}}::ì²´ë ¥}}}} / {{tonumber::{{dict_element::{{getvar::user}}::ìµœëŒ€ì²´ë ¥}}}} * 100}}%;">
        </div>
    </div>
    <span class="bar-value">{{dict_element::{{getvar::user}}::ì²´ë ¥}}</span>
</div>
<div class="x-risu-bar-container">
    <div class="progress-bar">
        <div class="x-risu-progress-bar-fill x-risu-st"
            style="width: {{calc::{{tonumber::{{dict_element::{{getvar::user}}::ê¸°ë ¥}}}} / {{tonumber::{{dict_element::{{getvar::user}}::ìµœëŒ€ê¸°ë ¥}}}} * 100}}%;">
        </div>
    </div>
    <span class="bar-value">{{dict_element::{{getvar::user}}::ê¸°ë ¥}}</span>
</div>
</div>
</div>
</div>
</section>

<!-- Management Panel -->
<section class="management-panel">
<div class="tabs-container">
<div class="tabs {{#if {{equal::{{getvar::category}}::items}}}}active{{/if}}" risu-btn="items">ì•„ì´í…œ</div>
<div class="tabs {{#if {{equal::{{getvar::category}}::traps}}}}active{{/if}}" risu-btn="traps">ë³´ìœ  ì „ë ¥
</div>
<div class="tabs {{#if {{equal::{{getvar::category}}::dungeon}}}}active{{/if}}" risu-btn="dungeon">ë˜ì „ í˜„í™©
</div>
</div>

<div class="tab-content">
{{#when::category::vis::items}}
{{#if {{?
{{dict_element::{{getvar::inventory}}::alchemy_knowledge}}==1||{{dict_element::{{getvar::inventory}}::demon_knowledge}}==1||{{dict_element::{{getvar::inventory}}::forbidden_knowledge}}==1}}}}
<span class="section-label">ì§€ì‹</span>
<div class="item-grid" style="margin-bottom:1rem;">
{{#if {{? {{dict_element::{{getvar::inventory}}::alchemy_knowledge}}==1}}}}<div
class="inventory-item"><strong>ì¡°í•©ì§€ì‹</strong></div>{{/if}}
{{#if {{? {{dict_element::{{getvar::inventory}}::demon_knowledge}}==1}}}}<div
class="inventory-item"><strong>ë§ˆê³„ì§€ì‹</strong></div>{{/if}}
{{#if {{? {{dict_element::{{getvar::inventory}}::forbidden_knowledge}}==1}}}}<div
class="inventory-item" style="border-color:#880e4f"><strong>ê¸ˆë‹¨ì˜ì§€ì‹</strong></div>{{/if}}
</div>
{{/if}}

<span class="section-label">ì¡°êµ ë„êµ¬</span>
<div class="info-grid">
{{settempvar::tools::0}}
{{#each {{getvar::toolsList}} tool}}
{{#if {{? {{dict_element::{{getvar::inventory}}::{{slot::tool}}}}==1}}}}
<div class="inventory-item"><span>{{dict_element::{{getvar::itemNameMap}}::{{slot::tool}}}}</span>
</div>
{{settempvar::tools::1}}
{{/if}}
{{/each}}
{{#if {{? {{gettempvar::tools}}==0}}}}<div style="font-size:0.8rem; color:#555;">ë³´ìœ  ë„êµ¬ ì—†ìŒ</div>
{{/if}}
</div>

<span class="section-label" style="margin-top:1rem;">ì†Œëª¨í’ˆ</span>
<div class="info-grid">
{{settempvar::consumables::0}}
{{#each {{getvar::consumablesList}} consumable}}
{{#if {{? {{tonumber::{{dict_element::{{getvar::inventory}}::{{slot::consumable}}}}}}>0}}}}
<div class="inventory-item">
<span>{{dict_element::{{getvar::itemNameMap}}::{{slot::consumable}}}}</span>
<span>x{{dict_element::{{getvar::inventory}}::{{slot::consumable}}}}</span>
</div>
{{settempvar::consumables::1}}
{{/if}}
{{/each}}
{{#if {{? {{gettempvar::consumables}}==0}}}}<div style="font-size:0.8rem; color:#555;">ë³´ìœ  ì†Œëª¨í’ˆ ì—†ìŒ
</div>{{/if}}
</div>
{{/when}}

{{#when::category::vis::traps}}
<span class="section-label">ëª¬ìŠ¤í„°</span>
<div class="info-grid">
{{getvar::monsterListHtml}}
</div>

<span class="section-label" style="margin-top:1rem;">í•¨ì •</span>
<div class="info-grid">
    {{getvar::trapListHtml}}
</div>
{{/when}}

{{#when::category::vis::dungeon}}
{{getvar::dungeonStatusHtml}}
{{/when}}
</div>
</section>

<!-- Command Panel -->
<section class="command-panel">
<span class="section-label">í–‰ë™ ì„ íƒ</span>
<div class="command-container">
{{getvar::cmds}}
</div>
</section>
</main>
</div>
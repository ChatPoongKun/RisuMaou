[main/items/hidden] function(triggerId)
    local mainCat = "items"
    setChatVar(triggerId, "category", mainCat)
    sysFunction(triggerId, "item.sys", "category", mainCat)
end!!

[main/traps/hidden] function(triggerId)
    local mainCat = "traps"
    setChatVar(triggerId, "category", mainCat)
    
    -- 인벤토리 및 DB 로드
    local inventory = json.decode(getChatVar(triggerId, "inventory") or "{}")
    local monsterDB = getDB(triggerId, "monsters.db")
    local trapDB = getDB(triggerId, "trap.db")
    
    -- 몬스터 리스트 생성
    local monHtml = ""
    local monCount = 0
    for k, v in pairs(inventory) do
        local mKey = k:match("^monster:(.+)$")
        if mKey and monsterDB[mKey] and tonumber(v) > 0 then
            monCount = monCount + 1
            local path = "{{raw::"..mKey .. "}}"
            local name = monsterDB[mKey].name
            local rating = monsterDB[mKey].rating
            monHtml = monHtml .. string.format([[
<div class="inventory-item" title="%s (Rating: %s)">
<img src="%s" style="width:64px;height:64px;vertical-align:middle;margin:0;">
<span style="margin-left:4px;">%s</span>
</div>
]], name, rating, path, name)
        end
    end
    if monCount == 0 then monHtml = "<div style='font-size:0.8rem; color:#555;'>보유 몬스터 없음</div>" end
    setChatVar(triggerId, "monsterListHtml", monHtml)
    
    -- 함정 리스트 생성
    local trapHtml = ""
    local trapCount = 0
    for k, v in pairs(inventory) do
        -- 기존 "trap:" 접두사가 있는 경우와 없는 경우(trapDB 키와 일치) 모두 체크
        local tKey = k:match("^trap:(.+)$")
        if tKey and trapDB[tKey] then
             -- 접두사가 있는 경우
        elseif trapDB[k] then
             -- 접두사가 없는 경우 (순수 키값)
             tKey = k
        else
             tKey = nil
        end

        if tKey and tonumber(v) > 0 then
            trapCount = trapCount + 1
            local path = tKey .. ".png"
            local name = trapDB[tKey].name
            local rating = trapDB[tKey].rating
            trapHtml = trapHtml .. string.format([[
<div class="inventory-item" title="%s (Rating: %s)">
<img src="%s" style="width:64px;height:64px;vertical-align:middle;margin:0;">
<span style="margin-left:4px;">%s</span>
</div>
]], name, rating, path, name)
        end
    end
    if trapCount == 0 then trapHtml = "<div style='font-size:0.8rem; color:#555;'>보유 함정 없음</div>" end
    setChatVar(triggerId, "trapListHtml", trapHtml)
end!!

[main/dungeon/hidden] function(triggerId)
    local mainCat = "dungeon"
    setChatVar(triggerId, "category", mainCat)
    
    -- Dungeon rendering using shared logic (read-only mode)
    local html = sysFunction(triggerId, "dungeon.sys", "getGridHtml", true)
    setChatVar(triggerId, "dungeonStatusHtml", html)
end!!


[main/100/조교 시작] function(triggerId)
    local screen = "preTrain"
    screenChange(triggerId, screen)
    setChatVar(triggerId, "category", "index")
    sysFunction(triggerId, "char.sys", "list")
end!!

[main/101/캐릭터 정보] function(triggerId)
    local screen = "charList"
    screenChange(triggerId, screen)
    setChatVar(triggerId, "category", "index")
    sysFunction(triggerId, "char.sys", "list")
end!!

[main/102/포로 처분] function(triggerId)
    local screen = "disposal"
    alertNormal(triggerId, screen.." 미구현")
    --[[screenChange(triggerId, screen)
    setChatVar(triggerId, "category", "index")
    sysFunction(triggerId, "char.sys", "list")]]
end!!

[main/103/노예 매각] function(triggerId)
    local screen = "노예 매각"
    alertNormal(triggerId, screen.." 미구현")
end!!

[main/104/마계 상점] function(triggerId)
    local screen = "shop"
    screenChange(triggerId, screen)
    local itemCat = "tools"
    setChatVar(triggerId, "category", itemCat)
    sysFunction(triggerId, "item.sys", "category", itemCat)
end!!

[main/105/장비 관리] function(triggerId)
    local screen = "장비 관리"
    alertNormal(triggerId, screen.." 미구현")
end!!

[main/106/격퇴] function(triggerId)
    local screen = "격퇴"
    alertNormal(triggerId, screen.." 미구현")
end!!

[main/107/침공] function(triggerId)
    local screen = "침공"
    alertNormal(triggerId, screen.." 미구현")
end!!

[main/108/던전 관리] function(triggerId)
    local screen = "dungeon"
    local dungeon = getState(triggerId, "dungeon")
    if not dungeon then
        dungeon = { floors = 1, grid = {} }
        setState(triggerId, "dungeon", dungeon)
    end
    setChatVar(triggerId, "dungeonLv", dungeon.floors)
    
    -- 초기화 (탭 및 소환 비용)
    setChatVar(triggerId, "category", "place")
    setChatVar(triggerId, "summonInvest", "2500")
    
    screenChange(triggerId, screen)
    sysFunction(triggerId, "dungeon.sys", "render") -- 초기화 로직 실행
end!!

[main/109/{{#when::{{? {{dict_element::{{getvar::inventory}}::음마지식}}==1}}}}실험실{{/when}}] function(triggerId)
    local screen = "실험실"
    alertNormal(triggerId, screen.." 미구현")
end!!

[main/199/휴식] function(triggerId)
    --하루가 지나갈때의 처리는 복잡한 처리가 필요하므로 유지관리를 위해 별도처리
    sysFunction(triggerId, "turnEnd.sys")
end!!

[main/hr/ ] function end!!

[main/777/설정] function(triggerId)
    local screen = "config"
    setChatVar(triggerId, "category", "play")
    screenChange(triggerId, screen)
end!!

[main/999/마계사전] function(triggerId)
    local screen = "dictionary"
    screenChange(triggerId, screen)
    setChatVar(triggerId, "category", "d_abl")
    setChatVar(triggerId, "dictTitle", "마계사전")
    setChatVar(triggerId, "dictDesc", "카테고리를 선택해 마계사전을 펼쳐보세요.")
end!!

[main/666/cheat] function(triggerId)
    local screen = "cheat"
    screenChange(triggerId, screen)
end!!